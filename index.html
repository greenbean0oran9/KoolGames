<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KoolGames</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    background: black;
    color: white;
    font-family: Arial, sans-serif;
    height: 100%;
    overflow: hidden;
}

/* CLICK TO START */
#startOverlay {
    position: absolute;
    inset: 0;
    background: black;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    cursor: pointer;
    z-index: 10;
}

/* STAGE */
#stage {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
}

/* INTRO TEXT */
#introText {
    font-size: 48px;
    animation: fontCycle 0.2s infinite;
    transition: opacity 1s ease;
}

@keyframes fontCycle {
    0% { font-family: Arial; }
    25% { font-family: "Comic Sans MS"; }
    50% { font-family: "Courier New"; }
    75% { font-family: "Times New Roman"; }
}

/* FLASH */
#flash {
    position: absolute;
    inset: 0;
    background: white;
    opacity: 0;
    pointer-events: none;
    transition: opacity 3s ease;
}

/* LOGO */
#logo {
    width: 420px;
    opacity: 0;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    animation: sway 4s ease-in-out infinite;
    transition: top 1.2s ease, opacity 2s ease;
}

@keyframes sway {
    0%, 100% { transform: translateY(-50%) rotate(-2deg); }
    50% { transform: translateY(-50%) rotate(2deg); }
}

/* UI */
#ui {
    position: absolute;
    top: 55%;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 14px;
    opacity: 0;
    transition: opacity 1s ease;
}

/* INPUTS */
input {
    background: black;
    color: white;
    border: 2px solid white;
    border-radius: 999px;
    padding: 14px 20px;
    font-size: 16px;
    width: 320px;
    text-align: center;
    outline: none;
}

/* BUTTONS */
button {
    background: white;
    color: black;
    border: 2px solid white;
    border-radius: 999px;
    padding: 14px 26px;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.4s ease;
}

button:hover {
    background: black;
    color: white;
}

/* EMOJIS */
.custom-emoji {
    width: 1em;
    height: 1em;
    vertical-align: -0.15em;
    image-rendering: pixelated;
}
</style>
</head>

<body>

<div id="startOverlay">CLICK TO START</div>

<div id="stage">
    <div id="introText">KoolGames :) :YARR:</div>
    <img id="logo" src="koolgmaes.png">
    <div id="ui">
        <div id="loginArea"></div>
    </div>
</div>

<div id="flash"></div>

<audio id="itemSound" src="mario-kart-wii-item-box.mp3"></audio>
<audio id="bgMusic" src="Eternal Towers of Hell OST - Skyward Archipelago 4.mp3" loop></audio>

<script src="emoji-preset.js"></script>

<script>
const startOverlay = document.getElementById("startOverlay");
const introText = document.getElementById("introText");
const logo = document.getElementById("logo");
const ui = document.getElementById("ui");
const flash = document.getElementById("flash");
const loginArea = document.getElementById("loginArea");

const itemSound = document.getElementById("itemSound");
const bgMusic = document.getElementById("bgMusic");

introText.innerHTML = parseEmojis(introText.innerHTML);

/* UTIL */
function generatePasskey() {
    return Math.random().toString(36).slice(2, 10).toUpperCase();
}

function getAccounts() {
    return JSON.parse(localStorage.getItem("accounts") || "{}");
}

function saveAccounts(acc) {
    localStorage.setItem("accounts", JSON.stringify(acc));
}

/* UI RENDER */
function renderUI() {
    const current = localStorage.getItem("currentUser");

    if (current) {
        loginArea.innerHTML = `
            <button id="helloBtn"></button>
            <button onclick="logout()">Log out</button>
        `;
        const helloBtn = document.getElementById("helloBtn");
        helloBtn.innerHTML = parseEmojis(`hello ${current}`);
        helloBtn.onclick = () => {
            window.location.href = "games.html";
        };
        return;
    }

    loginArea.innerHTML = `
        <button onclick="showLogin()">Login</button>
        <button onclick="showSignup()">Sign Up</button>
    `;
}

/* LOGIN */
function showLogin() {
    loginArea.innerHTML = `
        <input id="loginUser" placeholder="username">
        <input id="loginKey" placeholder="passkey">
        <button onclick="login()">Login</button>
        <button onclick="renderUI()">Back</button>
    `;
}

function login() {
    const user = document.getElementById("loginUser").value.trim();
    const key = document.getElementById("loginKey").value.trim();
    const accounts = getAccounts();

    if (!accounts[user] || accounts[user].passkey !== key) {
        alert("Invalid username or passkey");
        return;
    }

    localStorage.setItem("currentUser", user);
    renderUI();
}

/* SIGN UP */
function showSignup() {
    loginArea.innerHTML = `
        <input id="signupEmail" placeholder="email">
        <input id="signupUser" placeholder="username (emojis ok)">
        <button onclick="signup()">Create Account</button>
        <button onclick="renderUI()">Back</button>
    `;
}

function signup() {
    const email = document.getElementById("signupEmail").value.trim();
    const user = document.getElementById("signupUser").value.trim();

    if (!email || !user) return;

    const accounts = getAccounts();
    if (accounts[user]) {
        alert("Username already exists");
        return;
    }

    const passkey = generatePasskey();
    accounts[user] = { email, passkey };
    saveAccounts(accounts);

    alert(`SAVE THIS PASSKEY:\n\n${passkey}`);
    localStorage.setItem("currentUser", user);
    renderUI();
}

/* LOGOUT */
function logout() {
    localStorage.removeItem("currentUser");
    renderUI();
}

/* START SEQUENCE */
startOverlay.onclick = () => {
    startOverlay.style.display = "none";
    itemSound.play();

    setTimeout(() => {
        flash.style.opacity = "1";
        introText.style.opacity = "0";
    }, 3000);

    setTimeout(() => flash.style.opacity = "0", 3300);

    setTimeout(() => {
        logo.style.opacity = "1";
        bgMusic.volume = 0.5;
        bgMusic.play();
    }, 3600);

    setTimeout(() => {
        logo.style.top = "30%";
        ui.style.opacity = "1";
        renderUI();
    }, 5600);
};
</script>

</body>
</html>
